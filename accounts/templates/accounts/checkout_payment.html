{% extends "accounts/base_client.html" %}

{% block title %}Payment ‚Äî {{ seller.business_name|default:seller.user.username }} ‚Äî DZSTORE{% endblock %}

{% block header_actions %}
    <a href="{% url 'cart' %}" class="btn btn-ghost">‚Üê Back to cart</a>
{% endblock %}

{% block content_inner %}
    <h2 class="page-title">Payment</h2>
    <p class="page-desc">Seller: {{ seller.business_name|default:seller.user.username }} ¬∑ Total: {{ total }} DZD</p>

    <div style="display:grid; gap:24px; max-width:720px;">
        <div class="card">
            <h3 style="font-size:18px; margin-bottom:16px; color:#1e293b;">Order summary</h3>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Qty</th>
                            <th>Price</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for line in cart_lines %}
                            <tr>
                                <td><strong>{{ line.product.name }}</strong></td>
                                <td>{{ line.quantity }}</td>
                                <td>{{ line.product.price }} DZD</td>
                                <td>{{ line.subtotal }} DZD</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <p style="margin-top:16px; font-size:18px; font-weight:700;">Total: {{ total }} DZD</p>
        </div>

        <div class="card payment-card">
            <div class="payment-badge">üîí Demo only ¬∑ No real charges</div>
            <h3 style="font-size:18px; margin-bottom:16px; color:#1e293b;">Payment details</h3>
            <form method="post" action="{% url 'checkout' %}" id="payment-form">
                {% csrf_token %}
                <div class="form-group">
                    <label>Payment method</label>
                    <div class="payment-methods">
                        {% for value, label in form.method.field.choices %}
                            <label class="payment-method-option">
                                <input type="radio" name="method" value="{{ value }}" {% if form.method.value == value or not form.method.value and value == "card" %}checked{% endif %}>
                                <span>{{ label }}</span>
                            </label>
                        {% endfor %}
                    </div>
                    {{ form.method.errors }}
                </div>
                <div class="form-group">
                    <label for="id_cardholder">{{ form.cardholder.label }}</label>
                    {{ form.cardholder }}
                    {{ form.cardholder.errors }}
                </div>
                <div class="form-group">
                    <label for="id_card_number">{{ form.card_number.label }}</label>
                    {{ form.card_number }}
                    {{ form.card_number.errors }}
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px;">
                    <div class="form-group">
                        <label for="id_expiry_month">{{ form.expiry_month.label }}</label>
                        {{ form.expiry_month }}
                        {{ form.expiry_month.errors }}
                    </div>
                    <div class="form-group">
                        <label for="id_expiry_year">{{ form.expiry_year.label }}</label>
                        {{ form.expiry_year }}
                        {{ form.expiry_year.errors }}
                    </div>
                    <div class="form-group">
                        <label for="id_cvv">{{ form.cvv.label }}</label>
                        {{ form.cvv }}
                        {{ form.cvv.errors }}
                    </div>
                </div>
                <div class="form-actions" style="margin-top:24px;">
                    <button type="submit" class="btn btn-primary">Pay {{ total }} DZD</button>
                    <a href="{% url 'cart' %}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>

    <style>
        .payment-badge {
            display: inline-block;
            padding: 6px 12px;
            background: var(--warning-bg);
            color: var(--warning-text);
            font-size: 13px;
            font-weight: 600;
            border-radius: var(--radius-sm);
            margin-bottom: 16px;
        }
        .payment-methods { display: flex; flex-wrap: wrap; gap: 12px; }
        .payment-method-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: border-color var(--transition), background var(--transition);
        }
        .payment-method-option:hover { border-color: var(--primary); background: #f8fafc; }
        .payment-method-option input { margin: 0; }
        .payment-method-option:has(input:checked) { border-color: var(--primary); background: rgba(99, 102, 241, 0.06); }
        @media (max-width: 600px) {
            [style*="grid-template-columns:1fr 1fr 1fr"] { grid-template-columns: 1fr; }
        }
    </style>
{% endblock %}
