{% extends "accounts/base_client.html" %}

{% block title %}{{ seller.business_name|default:seller.user.username }} ‚Äî Market ‚Äî DZSTORE{% endblock %}

{% block header_actions %}
    <a href="{% url 'home_client' %}" class="btn btn-ghost">‚Üê All sellers</a>
    {% if cart_count > 0 %}
        <a href="{% url 'cart' %}" class="btn btn-primary">üõí Cart ({{ cart_count }})</a>
    {% endif %}
{% endblock %}

{% block content_inner %}
    <h2 class="page-title">{{ seller.business_name|default:seller.user.username }}‚Äôs Market</h2>
    <p class="page-desc">Browse by category. Full product details, add to cart or wishlist.</p>

    {% if categories %}
        {% for cat in categories %}
            <section class="market-category">
                <h3 class="category-title">{{ cat.name }}</h3>
                <div class="product-detail-list">
                    {% for p in cat.products %}
                        <article class="product-detail-card">
                            <div class="product-detail-image">
                                {% if p.image %}
                                    <img src="{{ p.image }}" alt="{{ p.name }}" loading="lazy">
                                {% else %}
                                    <span class="thumb-placeholder">No image</span>
                                {% endif %}
                            </div>
                            <div class="product-detail-body">
                                <div class="product-detail-header">
                                    <h4 class="product-detail-name">{{ p.name }}</h4>
                                    <span class="product-detail-category">{{ p.get_category_display }}</span>
                                </div>
                                {% if p.description %}
                                    <div class="product-detail-description">{{ p.description }}</div>
                                {% endif %}
                                <div class="product-detail-meta">
                                    <span class="product-detail-price">{{ p.price }} DZD</span>
                                    <span class="product-detail-stock">In stock: {{ p.quantity }}</span>
                                </div>
                                <div class="product-detail-actions">
                                    {% if p.quantity > 0 %}
                                        <form method="post" action="{% url 'add_to_cart' seller.id %}" class="product-detail-cart-form">
                                            {% csrf_token %}
                                            <input type="hidden" name="product_id" value="{{ p.id }}">
                                            <input type="hidden" name="next" value="{% url 'client_seller_products' seller.id %}">
                                            <label for="qty-{{ p.id }}" class="qty-label">Qty</label>
                                            <input type="number" name="quantity" id="qty-{{ p.id }}" value="1" min="1" max="{{ p.quantity }}" class="qty-input">
                                            <button type="submit" class="btn btn-primary">üõí Add to cart</button>
                                        </form>
                                        {% if p.id in wishlist_product_ids %}
                                            <span class="btn btn-ghost wishlist-done">‚ù§Ô∏è In wishlist</span>
                                        {% else %}
                                            <a href="{% url 'add_to_wishlist' p.id %}?next={% url 'client_seller_products' seller.id %}" class="btn btn-ghost">‚ù§Ô∏è Add to wishlist</a>
                                        {% endif %}
                                    {% else %}
                                        <span class="out-of-stock-label">Out of stock ‚Äî add to wishlist to save for later</span>
                                        {% if p.id in wishlist_product_ids %}
                                            <span class="btn btn-ghost wishlist-done">‚ù§Ô∏è In wishlist</span>
                                        {% else %}
                                            <a href="{% url 'add_to_wishlist' p.id %}?next={% url 'client_seller_products' seller.id %}" class="btn btn-primary">‚ù§Ô∏è Add to wishlist</a>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>
            </section>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>This seller has no products yet.</p>
        </div>
    {% endif %}

    <style>
        .market-category { margin-bottom: 40px; }
        .category-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary);
        }
        .product-detail-list { display: flex; flex-direction: column; gap: 24px; }
        .product-detail-card {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
            background: #fff;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        .product-detail-image {
            min-height: 200px;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .product-detail-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .product-detail-body { padding: 24px; display: flex; flex-direction: column; }
        .product-detail-header { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
        .product-detail-name { font-size: 22px; font-weight: 600; color: #1e293b; margin: 0; }
        .product-detail-category {
            font-size: 13px;
            padding: 4px 10px;
            background: #e0e7ff;
            color: var(--primary-dark);
            border-radius: 6px;
            font-weight: 600;
        }
        .product-detail-description {
            font-size: 15px;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 16px;
            white-space: pre-wrap;
        }
        .product-detail-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .product-detail-price { font-size: 20px; font-weight: 700; color: var(--primary); }
        .product-detail-stock { font-size: 14px; color: #64748b; }
        .product-detail-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }
        .product-detail-cart-form {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        .product-detail-cart-form .qty-label { font-size: 14px; color: #64748b; }
        .product-detail-cart-form .qty-input {
            width: 72px;
            padding: 8px 10px;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-sm);
            font-size: 15px;
        }
        .out-of-stock-label {
            font-size: 14px;
            color: #64748b;
            font-style: italic;
        }
        .out-of-stock { cursor: default; opacity: 0.8; }
        .wishlist-done { cursor: default; opacity: 0.8; }
        @media (max-width: 700px) {
            .product-detail-card { grid-template-columns: 1fr; }
            .product-detail-image { min-height: 180px; }
        }
    </style>
{% endblock %}
